-- 1. Найдите все отряды, у которых нет лидера.


```
SELECT 
	name, squad_id 
FROM 
	Squads
WHERE
	leader_id is NULL
```

-- 2. Получите список всех гномов старше 150 лет, у которых профессия "Warrior".


```
SELECT 
	dwarf_id, name, age, profession
FROM 
	Dwarves
WHERE
	age > 150 and profession = 'Warrior'
```

-- 3. Найдите гномов, у которых есть хотя бы один предмет типа "weapon".

```
SELECT 
	d.name 
FROM
	Dwarves as d
INNER JOIN
	Items i ON i.owner_id=d.dwarf_id
WHERE
	i.type='weapon';
```

-- 4. Получите количество задач для каждого гнома, сгруппировав их по статусу.


```
SELECT 
	d.name as dwarf_name,
    status as ticket_status,
    COUNT(task_id) as count_task
FROM 
	Tasks
INNER JOIN
	Dwarves as d
ON
	d.dwarf_id = Tasks.assigned_to
GROUP BY
	d.name, status
ORDER BY
	d.name, status;
```

-- 5. Найдите все задачи, которые были назначены гномам из отряда с именем "Guardians".

```
SELECT 
	task_id, description
FROM
	Tasks as t
INNER JOIN
	Dwarves as d
ON
	t.assigned_to = d.dwarf_id
INNER JOIN
	Squads S
ON
	s.squad_id = d.squad_id
WHERE
	s.name='Guardians'
;
```

-- 6. Выведите всех гномов и их ближайших родственников, указав тип родственных отношений.
``` 
WITH dwarfs_and_relationship AS (
  SELECT d.name, r.related_to, r.relationship 
  FROM 
  	Dwarves as d
  LEFT JOIN
  	Relationships as r
  ON
	d.dwarf_id = r.dwarf_id
  WHERE 
  	r.relationship 
  in 
  	('Родитель', 'Ребенок', 'Супруг'))

SELECT 
	dwarfs_and_relationship.name as dwarf_name, 
	dwarfs_and_relationship.relationship,
    Dwarves.name as name_of_relative
FROM 
	dwarfs_and_relationship
INNER JOIN 
	Dwarves
ON 
	dwarfs_and_relationship.related_to = Dwarves.dwarf_id
;
```
